!function(){"use strict";function t(t,e,r){var a,c=t,i=e,s=[],l=function(){u.then(function(t){f(i)})},f=function(t){i=t,_(r)},_=function(t){$.get("/ajax/chapter_datas",{"fiction_id":c,"chapter_id":i},function(o){if($("#init_loading").hide(),0==o.result){var e=o.url;n.getJSONP(e,function(o){setTimeout(function(){$("#loading").hide().html("正在加载中..."),$("#Tag__pro").html(i+1+"/"+a.length)},500);var n=JSON.parse(o);n.sure=!0,t&&t(n)})}else $("#loading").show().html("暂无数据"),t&&t({"t":a[i].title,"p":["暂无书籍详情..."],"sure":!1})},"json")},u=new Promise(function(t,o){$.ajax({"url":"/ajax/chapters","type":"get","data":{"fiction_id":c},"dataType":"json","success":function(e){if(0==e.result){a=e.item.toc,$("#Tag__pro").html(i+1+"/"+a.length);for(var r=0;r<a.length;r++)s.push({"chapter_id":a[r].chapter_id,"title":a[r].title});t(s),n.StorageSetter(c+"_toc",JSON.stringify(a))}else o(e)},"error":function(t){}})}),d=function(){0!=(i=parseInt(i))&&(i--,f(i),n.StorageSetter(c+"_last_chapter",i))},h=function(){(i=parseInt(i))!=s.length-1&&(i++,f(i),n.StorageSetter(c+"_last_chapter",i))},g=function(t){(i=parseInt(i))!=s.length-1&&(i++,_(function(n){var e=$("#fiction_container"),r=e.html();o(e)(r,n),1==n.sure?t&&t(!0):t&&t(!1)}),n.StorageSetter(c+"_last_chapter",i))};return{"init":l,"go":f,"prev":d,"next":h,"getChapter_id":function(){return i},"getChapter":g}}function o(t){function o(t,o){for(var n=t+"<h4>"+o.t+"</h4>",e=0;e<o.p.length;e++)n+="<p>"+o.p[e]+"</p>";return n}return function(n,e){var r=n||"";t.html(o(r,e))}}var n=function(){function t(t,o){return $.jsonp({"url":t,"cache":!0,"callback":"duokan_fiction_chapter","success":function(t){var n=$.base64.decode(t),e=decodeURIComponent(escape(n));o(e)}})}return{"getJSONP":t,"StorageGetter":function(t){return localStorage.getItem("ficiton_reader_"+t)},"StorageSetter":function(t,o){return localStorage.setItem("ficiton_reader_"+t,o)}}}();(function(){$("#init_loading").show();var e=$("#fiction_container"),r={"fiction_id":parseInt(getUrlStr("fiction_id")),"chapter_id":parseInt(getUrlStr("chapter_id")),"from":getUrlStr("from")};r.fiction_id||history.back();var a,c=r.fiction_id,i=JSON.parse(n.StorageGetter(c+"_last_chapter"))||r.chapter_id,s=!1,l=document,f=l.body,_=$(window),u=!1,d={"bottom_tool_bar":$("#bottom_tool_bar"),"nav_title":$("#nav_title"),"bk_container":$("#bk-container"),"night_button":$("#night-button"),"next_button":$("#nextchapter"),"prev_button":$("#prevchapter"),"back_button":$("#back_button"),"top_nav":$("#top-nav"),"bottom_nav":$(".bottom_nav"),"progress":$("#Tag__pro")},h=o(e),g=t(c||13359,i||0,function(t){h("",t),d.bottom_tool_bar.show(),setTimeout(function(){s=!1,f.scrollTop=0},20)});g.init();(function(){for(var t=[{"value":"#f7eee5","name":"米白","font":""},{"value":"#e9dfc7","name":"纸张","font":"","id":"font_normal"},{"value":"#a4a4a4","name":"浅灰","font":""},{"value":"#cdefce","name":"护眼","font":""},{"value":"#283548","name":"灰蓝","font":"#7685a2","bottomcolor":"#fff"},{"value":"#0f1410","name":"夜间","font":"#4e534f","bottomcolor":"rgba(255,255,255,0.7)","id":"font_night"}],o=(n.StorageGetter("toolbar_background_color"),n.StorageGetter("bottom_color")),r=n.StorageGetter("background_color"),c=n.StorageGetter("font_color"),i=n.StorageGetter("background_color")||"#e9dfc7",s=n.StorageGetter("font_color"),l=0;l<t.length;l++){var f="none";i==t[l].value&&(f="block"),d.bk_container.append('<div class="bk-container" id="'+t[l].id+'" data-font="'+t[l].font+'"  data-bottomcolor="'+t[l].bottomcolor+'" data-color="'+t[l].value+'" style="background-color:'+t[l].value+'"><div class="bk-container-current" style="display:'+f+'"></div><span style="display:none">'+t[l].name+"</span></div>")}e.css("min-height",$(window).height()-100),o&&$("#bottom_tool_bar_ul").find("li").css("color",o),r&&$("body").css("background-color",r),c&&$(".m-read-content").css("color",c),"#4e534f"==s&&(u=!0,$("#day_icon").show(),$("#night_icon").hide(),$("#bottom_tool_bar_ul").css("opacity","0.6")),a=n.StorageGetter("font_size"),a=parseInt(a),a||(a=18),e.css("font-size",a),d.top_nav.css("opacity",0).hide(),d.bottom_nav.css("opacity",0).hide()})(),function(){d.night_button.click(function(){u?($("#day_icon").hide(),$("#night_icon").show(),$("#font_normal").trigger("click"),u=!1):($("#day_icon").show(),$("#night_icon").hide(),$("#font_night").trigger("click"),u=!0)}),d.bk_container.delegate(".bk-container","click",function(){var t=$(this).data("color"),o=$(this).data("font"),e=$(this).data("bottomcolor"),r=o;d.bk_container.find(".bk-container-current").hide(),$(this).find(".bk-container-current").show(),o||(o="#000"),r||(r="#fbfcfc"),e&&"undefined"!=e?$("#bottom_tool_bar_ul").find("li").css("color",e):$("#bottom_tool_bar_ul").find("li").css("color","#a9a9a9"),$("body").css("background-color",t),$(".m-read-content").css("color",o),n.StorageSetter("toolbar_background_color",r),n.StorageSetter("bottom_color",e),n.StorageSetter("background_color",t),n.StorageSetter("font_color",o),"#4e534f"==n.StorageGetter("font_color")?(u=!0,$("#day_icon").show(),$("#night_icon").hide(),$("#bottom_tool_bar_ul").css("opacity","0.6")):(u=!1,$("#day_icon").hide(),$("#night_icon").show(),$("#bottom_tool_bar_ul").css("opacity","0.9"))}),$(".spe-button").on("touchstart",function(){$(this).css("background","rgba(255,255,255,0.3)")}).on("touchmove",function(){$(this).css("background","none")}).on("touchend",function(){$(this).css("background","none")}),$("#large-font").click(function(){a>24||(a+=1,n.StorageSetter("font_size",a),e.css("font-size",a))}),$("#small-font").click(function(){a<12||(a-=1,n.StorageSetter("font_size",a),e.css("font-size",a))});for(var t=$(".font-container"),o=$("#font-button"),l=($("#menu_container"),0);l<t.length;l++)t.eq(l).css("transform","translate3d(0,"+t.height()+"px,0)");o.click(function(){var n=t.css("transform").replace(/[^0-9\-,]/g,"").split(",");n[1]<=t.height()&&n[1]>0?(o.addClass("current"),t.css("transform","translate3d(0, -"+d.bottom_nav.height()+"px,0)")):n[1]<0&&(o.removeClass("current"),t.show().css("transform","translate3d(0,"+t.height()+"px,0)"))}),e.click(function(){t.css("transform","translate3d(0,"+t.height()+"px,0)"),o.removeClass("current")}),_.scroll(function(){d.top_nav.css("opacity",0).hide(),d.bottom_nav.css("opacity",0).hide(),t.css("transform","translate3d(0,"+t.height()+"px,0)"),o.removeClass("current"),scroll().top+windowHeight()>=documentHeight()-50&&(s||(s=!0,$("#loading").show(),g.getChapter(function(t){s=!t})))}),d.next_button.click(function(){$("#init_loading").show(),g.next()}),d.prev_button.click(function(){$("#init_loading").show(),g.prev()}),$(".icon-back").click(function(){var t;if(t="book"==r.from?"main":r.from,c){if("categoryDetails"==t){var o=getUrlStr("cate_id"),n=getUrlStr("nav");return location.href="/book?id="+c+"&cate_id="+o+"&nav="+n+"&from="+t,!1}location.href="/book?id="+c+"&from="+t}}),$("#menu_button").click(function(){var t;if("categoryDetails"==(t="book"==r.from?"main":r.from)){var o=getUrlStr("cate_id"),n=getUrlStr("nav");return location.href="/chapter?fiction_id="+c+"&chapter_id="+i+"&cate_id="+o+"&nav="+n+"&from="+t,!1}location.href="/chapter?fiction_id="+c+"&chapter_id="+i+"&from="+t}),$("#action_mid").click(function(){0==d.top_nav.css("opacity")?(d.top_nav.show().css("opacity",1),d.bottom_nav.show().css("opacity",1)):(d.top_nav.css("opacity",0).hide(),d.bottom_nav.css("opacity",0).hide(),t.css("transform","translate3d(0,"+t.height()+"px,0)"),o.removeClass("current"))})}()})()}();